const express = require('express');
const cors = require('cors');
const path = require('path');
const app = express();
const PORT = process.env.PORT || 3001;
app.use(cors());
app.use(express.json());
app.use(express.static(path.join(__dirname, 'public')));

// === TICKER VALIDATION ===
const validTickers = ['AAPL','MSFT','GOOGL','GOOG','AMZN','NVDA','META','TSLA','BRK.B','UNH','JNJ','V','XOM','WMT','JPM','MA','PG','AVGO','HD','CVX','MRK','ABBV','LLY','PEP','KO','COST','ADBE','CRM','AMD','NFLX','TMO','ACN','MCD','CSCO','ABT','DHR','TXN','NEE','UPS','PM','INTC','HON','LOW','UNP','AMGN','IBM','BA','GE','CAT','SBUX','GS','BLK','ISRG','MDLZ','ADI','REGN','VRTX','GILD','BKNG','ADP','MMC','SYK','LRCX','SCHW','CB','ZTS','TMUS','MO','PLD','CI','SO','DUK','BDX','CME','CL','ICE','AON','BSX','SHW','FIS','NOC','LMT','RTX','GD','HII','PYPL','SQ','SHOP','COIN','MARA','RIOT','PLTR','SNOW','CRWD','NET','DDOG','ZS','OKTA','MDB','RIVN','NIO','LI','XPEV','LCID','F','GM','TM','DIS','WBD','PARA','CMCSA','SNAP','PINS','RBLX','ARM','SMCI','DELL','HPQ','ORCL','NOW','PANW','TSM','ASML','QCOM','MRVL','MU','KLAC','AMAT','BAC','MS','WFC','C','USB','PNC','TFC','PFE','MRNA','BMY','AZN','NVO','SNY','CVS','WBA','HCA','ELV','COP','SLB','OXY','EOG','DVN','HAL','BABA','JD','PDD','BIDU','TCEHY','NKE','LULU','TJX','ROST','UBER','LYFT','ABNB','DASH','AI','BBAI','SOUN','UPST','PATH','SOFI','HOOD','LC','NU','ENPH','SEDG','FSLR','RUN','SPY','QQQ','IWM','DIA','VOO','GLD','SLV','USO','TLT'];

function levenshtein(a,b){const m=a.length,n=b.length,dp=Array.from({length:m+1},()=>Array(n+1).fill(0));for(let i=0;i<=m;i++)dp[i][0]=i;for(let j=0;j<=n;j++)dp[0][j]=j;for(let i=1;i<=m;i++)for(let j=1;j<=n;j++)dp[i][j]=Math.min(dp[i-1][j]+1,dp[i][j-1]+1,dp[i-1][j-1]+(a[i-1]!==b[j-1]?1:0));return dp[m][n]}
function similarity(a,b){if(a===b)return 1;const l=a.length>b.length?a:b,s=a.length>b.length?b:a;if(!l.length)return 1;let bonus=0;for(let i=0;i<Math.min(a.length,b.length);i++){if(a[i]===b[i])bonus+=.15;else break}if(l.includes(s)||s.includes(l))bonus+=.3;return Math.min(1,(l.length-levenshtein(a,b))/l.length+bonus)}
app.post('/api/validate-ticker',(req,res)=>{const u=(req.body.ticker||'').toUpperCase().trim();if(validTickers.includes(u))return res.json({valid:true,ticker:u,suggestions:[]});const s=validTickers.map(t=>({ticker:t,score:similarity(u,t)})).filter(t=>t.score>.4).sort((a,b)=>b.score-a.score).slice(0,5).map(t=>t.ticker);res.json({valid:false,ticker:u,suggestions:s})});

// === SECTOR MAP ===
const sectorMap={'AAPL':{sector:'tech',related:['MSFT','GOOGL'],themes:['ìŠ¤ë§ˆíŠ¸í°','AI','í´ë¼ìš°ë“œ']},'MSFT':{sector:'tech',related:['AAPL','GOOGL','CRM'],themes:['í´ë¼ìš°ë“œ','AI','ì—”í„°í”„ë¼ì´ì¦ˆ']},'GOOGL':{sector:'tech',related:['META','MSFT','AMZN'],themes:['ê²€ìƒ‰','AI','ê´‘ê³ ']},'META':{sector:'tech',related:['GOOGL','SNAP','PINS'],themes:['ì†Œì…œë¯¸ë””ì–´','AI','ë©”íƒ€ë²„ìŠ¤']},'NVDA':{sector:'semiconductor',related:['AMD','INTC','TSM','AVGO','SMCI'],themes:['AIì¹©','GPU','ë°ì´í„°ì„¼í„°']},'AMD':{sector:'semiconductor',related:['NVDA','INTC','TSM'],themes:['CPU','GPU','ë°ì´í„°ì„¼í„°']},'INTC':{sector:'semiconductor',related:['NVDA','AMD','TSM'],themes:['ë°˜ë„ì²´','íŒŒìš´ë“œë¦¬','PC']},'TSM':{sector:'semiconductor',related:['NVDA','AMD','ASML'],themes:['íŒŒìš´ë“œë¦¬','ë°˜ë„ì²´ ì œì¡°','AIì¹©']},'AVGO':{sector:'semiconductor',related:['NVDA','QCOM','TXN'],themes:['ë„¤íŠ¸ì›Œí‚¹','ë°˜ë„ì²´','AI']},'TSLA':{sector:'ev',related:['RIVN','NIO','LI','F','LCID'],themes:['ì „ê¸°ì°¨','ììœ¨ì£¼í–‰','ë°°í„°ë¦¬']},'RIVN':{sector:'ev',related:['TSLA','LCID','F'],themes:['ì „ê¸°ì°¨','EV íŠ¸ëŸ­','ìƒì‚°']},'NIO':{sector:'ev',related:['TSLA','LI','XPEV'],themes:['ì¤‘êµ­ ì „ê¸°ì°¨','ë°°í„°ë¦¬ êµí™˜','EV']},'AMZN':{sector:'ecommerce',related:['SHOP','WMT','BABA'],themes:['ì´ì»¤ë¨¸ìŠ¤','AWS','ë¬¼ë¥˜']},'NFLX':{sector:'entertainment',related:['DIS','WBD','PARA'],themes:['ìŠ¤íŠ¸ë¦¬ë°','ì½˜í…ì¸ ','êµ¬ë…']},'JPM':{sector:'finance',related:['BAC','GS','MS','WFC'],themes:['ì€í–‰','ê¸ˆë¦¬','íˆ¬ìì€í–‰']},'GS':{sector:'finance',related:['JPM','MS','BAC'],themes:['íˆ¬ìì€í–‰','M&A','íŠ¸ë ˆì´ë”©']},'XOM':{sector:'energy',related:['CVX','COP','SLB'],themes:['ì„ìœ ','ì—ë„ˆì§€','ì •ìœ ']},'PLTR':{sector:'ai_software',related:['AI','SNOW','CRWD'],themes:['AI ë¶„ì„','ì •ë¶€ ê³„ì•½','ë¹…ë°ì´í„°']},'COIN':{sector:'crypto',related:['MARA','RIOT','HOOD'],themes:['ì•”í˜¸í™”í','ê±°ë˜ì†Œ','ë¹„íŠ¸ì½”ì¸']},'BA':{sector:'defense',related:['LMT','RTX','NOC','GD'],themes:['ë°©ì‚°','í•­ê³µ','ìš°ì£¼']}};
const sectorNames={ko:{tech:'ë¹…í…Œí¬',semiconductor:'ë°˜ë„ì²´',ev:'ì „ê¸°ì°¨',ecommerce:'ì´ì»¤ë¨¸ìŠ¤',entertainment:'ì—”í„°í…Œì¸ë¨¼íŠ¸',finance:'ê¸ˆìœµ',healthcare:'í—¬ìŠ¤ì¼€ì–´',energy:'ì—ë„ˆì§€',ai_software:'AI ì†Œí”„íŠ¸ì›¨ì–´',crypto:'ì•”í˜¸í™”í',fintech:'í•€í…Œí¬',defense:'ë°©ì‚°'},en:{tech:'Big Tech',semiconductor:'Semiconductors',ev:'EV',ecommerce:'E-Commerce',entertainment:'Entertainment',finance:'Finance',healthcare:'Healthcare',energy:'Energy',ai_software:'AI Software',crypto:'Crypto',fintech:'Fintech',defense:'Defense'}};

// === DATE UTILS ===
function genDate(hAgo){const d=new Date();d.setHours(d.getHours()-hAgo);return d.toISOString()}
function fmtTime(iso,lang){const now=new Date(),d=new Date(iso),h=Math.floor((now-d)/36e5),dd=Math.floor((now-d)/864e5);if(h<1)return lang==='ko'?'ë°©ê¸ˆ':'Just now';if(h<24)return lang==='ko'?`${h}ì‹œê°„ ì „`:`${h}h ago`;if(dd<7)return lang==='ko'?`${dd}ì¼ ì „`:`${dd}d ago`;return d.toLocaleDateString(lang==='ko'?'ko-KR':'en-US',{month:'short',day:'numeric'})}
function fmtDate(iso,lang){return new Date(iso).toLocaleDateString(lang==='ko'?'ko-KR':'en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})}
function pickRandom(a,n){return[...a].sort(()=>Math.random()-.5).slice(0,Math.min(n,a.length))}

// === NEWS ENDPOINT ===
app.post('/api/news',(req,res)=>{
  const{tickers,language}=req.body;
  try{
    const lang=language==='ko'?'ko':'en';
    let news=generateAllNews(tickers,lang);
    news.sort((a,b)=>{
      if(a.tier==='breaking'&&b.tier!=='breaking')return -1;
      if(b.tier==='breaking'&&a.tier!=='breaking')return 1;
      if(a.tier==='core'&&b.tier!=='core'&&b.tier!=='breaking')return -1;
      if(b.tier==='core'&&a.tier!=='core'&&a.tier!=='breaking')return 1;
      return new Date(b.date)-new Date(a.date);
    });
    news=news.map(n=>({...n,time:fmtTime(n.date,lang),dateFormatted:fmtDate(n.date,lang)}));
    res.json({success:true,news});
  }catch(e){res.status(500).json({success:false,error:e.message})}
});

function generateAllNews(t,l){return[...genBreaking(l),...genCore(t,l),...genRelated(t,l),...genMarket(l),...genFed(l),...genPolitics(l),...genUSChina(l),...genGeo(l),...genCrypto(l),...genTech(l),...genCommodities(l),...genEarnings(l),...genTrending(t,l)]}

// === TIER 0: BREAKING ===
function genBreaking(lang){
  const T={ko:[
    {t:"ğŸš¨ ì—°ì¤€, ê¸´ê¸‰ ê¸ˆë¦¬ 0.5%p ì¸í•˜",c:"ì—°ë°©ì¤€ë¹„ì œë„ê°€ ê¸´ê¸‰ FOMCë¥¼ ì†Œì§‘í•´ ê¸ˆë¦¬ë¥¼ 0.5%p ì¸í•˜í–ˆìŠµë‹ˆë‹¤. ê²½ê¸° ì¹¨ì²´ ëŒ€ì‘ìœ¼ë¡œ ì‹œì¥ ì „ë°˜ì— í° íŒŒì¥ì´ ì˜ˆìƒë©ë‹ˆë‹¤.",i:"positive"},
    {t:"ğŸš¨ íŠ¸ëŸ¼í”„, ì¤‘êµ­ì‚° ì „ í’ˆëª© 60% ê´€ì„¸ ì„œëª…",c:"ì¤‘êµ­ì‚° ëª¨ë“  ìˆ˜ì…í’ˆì— 60% ê´€ì„¸ë¥¼ ë¶€ê³¼í•˜ëŠ” í–‰ì •ëª…ë ¹ì´ ì„œëª…ë˜ì—ˆìŠµë‹ˆë‹¤. ê¸€ë¡œë²Œ ë¬´ì—­ ì§ˆì„œì— ê·¼ë³¸ì  ë³€í™”ê°€ ì‹œì‘ë©ë‹ˆë‹¤.",i:"negative"},
    {t:"ğŸš¨ ì¤‘êµ­ AI 'ì‹œë˜ìŠ¤ 2.0' ê³µê°œ, GPT-5 ëŠ¥ê°€ ì£¼ì¥",c:"ì¤‘êµ­ AI ê¸°ì—…ì´ GPT-5ë¥¼ ë›°ì–´ë„˜ëŠ”ë‹¤ê³  ì£¼ì¥í•˜ëŠ” ëª¨ë¸ì„ ê³µê°œí–ˆìŠµë‹ˆë‹¤. ë¯¸êµ­ AI ìš°ìœ„ì— ëŒ€í•œ ì¬í‰ê°€ê°€ ì‹œì‘ë˜ê³  ìˆìŠµë‹ˆë‹¤.",i:"negative"},
    {t:"ğŸš¨ ë¯¸êµ­ CPI ê¸‰ë“±, ì¸í”Œë ˆì´ì…˜ ì¬ë°œ ê³µí¬",c:"CPIê°€ ì „ì›” ëŒ€ë¹„ 0.8% ê¸‰ë“±í•˜ë©° ì¸í”Œë ˆì´ì…˜ ê³µí¬ê°€ í™•ì‚°ë˜ê³  ìˆìŠµë‹ˆë‹¤. ê¸ˆë¦¬ ì¸ìƒ ì¬ê°œ ê°€ëŠ¥ì„±ì´ ë¶€ê°ë©ë‹ˆë‹¤.",i:"negative"},
    {t:"ğŸš¨ S&P 500 í•˜ë£¨ 5% ê¸‰ë½, ì„œí‚·ë¸Œë ˆì´ì»¤ ë°œë™",c:"ê²½ê¸° ì¹¨ì²´ì™€ ì§€ì •í•™ì  ë¦¬ìŠ¤í¬ê°€ ê²¹ì¹˜ë©° S&P 500ì´ 5% ê¸‰ë½, ê±°ë˜ê°€ ì¼ì‹œ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.",i:"negative"},
    {t:"ğŸš¨ NVDA, DOJ ë°˜ë…ì  ì†Œì†¡ ì œê¸°",c:"ë²•ë¬´ë¶€ê°€ ì—”ë¹„ë””ì•„ë¥¼ AI ì¹© ë…ì  í˜ì˜ë¡œ ì†Œì†¡í–ˆìŠµë‹ˆë‹¤. AI ì‚°ì—… êµ¬ì¡° ë³€í™”ê°€ ì˜ˆìƒë©ë‹ˆë‹¤.",i:"negative"},
    {t:"ğŸš¨ ë¹„íŠ¸ì½”ì¸ 15ë§Œ ë‹¬ëŸ¬ ëŒíŒŒ, ì‚¬ìƒ ìµœê³ ",c:"ë¹„íŠ¸ì½”ì¸ì´ 15ë§Œ ë‹¬ëŸ¬ë¥¼ ëŒíŒŒí•˜ë©° ì‚¬ìƒ ìµœê³ ì¹˜ë¥¼ ê²½ì‹ í–ˆìŠµë‹ˆë‹¤. ê¸°ê´€ ë§¤ìˆ˜ì„¸ê°€ ê°€ê²©ì„ ê²¬ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤.",i:"positive"},
    {t:"ğŸš¨ ëŒ€ë§Œ í•´í˜‘ êµ°ì‚¬ ì¶©ëŒ ìœ„ê¸°, ê¸€ë¡œë²Œ íŒ¨ë‹‰",c:"ëŒ€ë§Œ í•´í˜‘ì—ì„œ ë¯¸ì¤‘ êµ°ì‚¬ ê¸´ì¥ì´ ê·¹ë„ë¡œ ê³ ì¡°ë˜ë©° TSMì´ 20% ì´ìƒ ê¸‰ë½í–ˆìŠµë‹ˆë‹¤.",i:"negative"},
  ],en:[
    {t:"ğŸš¨ Fed Cuts Rates 0.5% in Emergency",c:"The Fed convened an emergency FOMC and cut rates by 50bps. Markets bracing for major shockwaves.",i:"positive"},
    {t:"ğŸš¨ Trump Signs 60% Tariff on All Chinese Imports",c:"Executive order imposing 60% tariffs on all Chinese imports signed. Fundamental trade shift underway.",i:"negative"},
    {t:"ğŸš¨ China's 'Cidence 2.0' Claims to Beat GPT-5",c:"A Chinese AI firm unveiled a model claiming to surpass GPT-5. US AI dominance reassessment begins.",i:"negative"},
    {t:"ğŸš¨ US CPI Spikes, Inflation Fears Return",c:"CPI surged 0.8% MoM. Markets tumbling as rate hike fears resurface.",i:"negative"},
    {t:"ğŸš¨ S&P 500 Crashes 5%, Circuit Breakers Hit",c:"Recession fears and geopolitical risks sent S&P down 5%. Circuit breakers triggered.",i:"negative"},
    {t:"ğŸš¨ DOJ Sues NVDA for AI Chip Monopoly",c:"DOJ filed antitrust suit against Nvidia. AI industry structural changes expected.",i:"negative"},
    {t:"ğŸš¨ Bitcoin Breaks $150K All-Time High",c:"Bitcoin surged past $150K. Institutional buying and ETF inflows driving the rally.",i:"positive"},
    {t:"ğŸš¨ Taiwan Strait Crisis Sparks Global Panic",c:"US-China military tensions at extreme levels. TSM crashed 20%+ on supply chain fears.",i:"negative"},
  ]};
  return pickRandom(T[lang],3).map((item,i)=>({title:item.t,content:item.c,ticker:lang==='ko'?'âš¡ ì†ë³´':'âš¡ BREAKING',source:['Reuters FLASH','Bloomberg URGENT','AP Breaking','CNBC Alert'][i%4],date:genDate(Math.floor(Math.random()*3)),impact:item.i,tier:'breaking',tierLabel:lang==='ko'?'ğŸš¨ ì†ë³´':'ğŸš¨ BREAKING'}));
}

// === TIER 1: CORE ===
function genCore(tickers,lang){
  const T={ko:{p:[{t:"{t} ì‹¤ì  ë°œí‘œ í›„ ê¸‰ë“±",c:"{t}ê°€ ì˜ˆìƒì„ ë›°ì–´ë„˜ëŠ” ì‹¤ì ì„ ë°œí‘œí–ˆìŠµë‹ˆë‹¤."},{t:"{t} ì‹ ì œí’ˆìœ¼ë¡œ ê¸°ëŒ€ê° ê³ ì¡°",c:"{t}ê°€ í˜ì‹ ì ì¸ ì‹ ì œí’ˆì„ ê³µê°œí–ˆìŠµë‹ˆë‹¤."},{t:"{t} CEO ë‚™ê´€ì  ì „ë§",c:"{t} CEOê°€ ì„±ì¥ì— ìì‹ ê°ì„ í‘œëª…í–ˆìŠµë‹ˆë‹¤."},{t:"{t} ìì‚¬ì£¼ ë§¤ì… ë°œí‘œ",c:"{t}ê°€ ëŒ€ê·œëª¨ ìì‚¬ì£¼ ë§¤ì…ì„ ë°œí‘œí–ˆìŠµë‹ˆë‹¤."},{t:"{t} ëª©í‘œê°€ ìƒí–¥",c:"ì¦ê¶Œì‚¬ë“¤ì´ {t} ëª©í‘œê°€ë¥¼ ìƒí–¥í–ˆìŠµë‹ˆë‹¤."},{t:"{t} AI ì‚¬ì—… í™•ëŒ€",c:"{t}ê°€ AI íˆ¬ìë¥¼ ë‹¨í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤."}],n:[{t:"{t} ê·œì œ ìš°ë ¤ í•˜ë½",c:"{t}ê°€ ê·œì œ ì´ìŠˆë¡œ í•˜ë½ ì¤‘ì…ë‹ˆë‹¤."},{t:"{t} ì‹¤ì  ê¸°ëŒ€ í•˜íšŒ",c:"{t} ì‹¤ì ì´ ì˜ˆìƒì„ ë°‘ëŒì•˜ìŠµë‹ˆë‹¤."},{t:"{t} ë§ˆì§„ ì••ë°•",c:"{t}ê°€ ê²½ìŸìœ¼ë¡œ ìˆ˜ìµì„± ìš°ë ¤ê°€ ì»¤ì¡ŒìŠµë‹ˆë‹¤."},{t:"{t} ë‚´ë¶€ì ë§¤ë„",c:"{t} ê²½ì˜ì§„ ë§¤ë„ê°€ ì•Œë ¤ì¡ŒìŠµë‹ˆë‹¤."},{t:"{t} ì†Œì†¡ ë¦¬ìŠ¤í¬",c:"{t}ê°€ ì†Œì†¡ì— íœ˜ë§ë ¸ìŠµë‹ˆë‹¤."}]},en:{p:[{t:"{t} Surges on Earnings",c:"{t} beat Wall Street expectations."},{t:"{t} New Product Excites",c:"{t} unveiled breakthrough innovation."},{t:"{t} CEO Bullish",c:"{t}'s CEO confident on growth."},{t:"{t} Major Buyback",c:"{t} announced significant buyback."},{t:"{t} Targets Raised",c:"Brokerages raised {t} targets."},{t:"{t} AI Expansion",c:"{t} investing heavily in AI."}],n:[{t:"{t} Falls on Regulation",c:"{t} hit by regulatory concerns."},{t:"{t} Misses Estimates",c:"{t} results below expectations."},{t:"{t} Margin Pressure",c:"{t} facing competitive pressure."},{t:"{t} Insider Selling",c:"Insider selling reported at {t}."},{t:"{t} Litigation Risk",c:"{t} facing major lawsuit."}]}};
  const news=[];
  tickers.forEach((ticker,idx)=>{const num=Math.random()>.3?2:3;const used=new Set();for(let i=0;i<num;i++){const s=Math.random()>.35?'p':'n';let ti;do{ti=Math.floor(Math.random()*T[lang][s].length)}while(used.has(`${s}${ti}`)&&used.size<T[lang][s].length);used.add(`${s}${ti}`);const tmpl=T[lang][s][ti];news.push({title:tmpl.t.replace(/{t}/g,ticker),content:tmpl.c.replace(/{t}/g,ticker),ticker,source:['Reuters','Bloomberg','CNBC','MarketWatch','WSJ'][idx%5],date:genDate(Math.floor(Math.random()*48)+1),impact:s==='p'?'positive':'negative',tier:'core',tierLabel:lang==='ko'?'ğŸ“Œ ë‚´ ì¢…ëª©':'ğŸ“Œ My Stocks'})}});
  return news;
}

// === TIER 2: RELATED ===
function genRelated(tickers,lang){
  const T={ko:["{sector}, {theme} ìˆ˜ìš” ì¦ê°€ â€” {rt} ìˆ˜í˜œ ê¸°ëŒ€","{rt}, {theme} ê²½ìŸë ¥ ê°•í™” â€” ì‹œì¥ ì£¼ëª©","{sector} ETF ìê¸ˆ ìœ ì… â€” {rt} ê°•ì„¸","{rt} {theme} ì‹ ê¸°ìˆ  â€” ì—…ê³„ ì£¼ëª©","{sector} ì „ë§ ê¸ì • â€” {rt} ê°œì„  ê¸°ëŒ€"],en:["{sector} Gains on {theme} â€” {rt} benefiting","{rt} Strengthens in {theme}","{sector} ETFs See Inflows â€” {rt} strong","{rt} New {theme} Tech â€” Attention","{sector} Outlook Bullish â€” {rt} improving"]};
  const news=[],usedT=new Set(tickers),sectors=new Set();
  tickers.forEach(ticker=>{const info=sectorMap[ticker];if(info&&!sectors.has(info.sector)){sectors.add(info.sector);info.related.filter(t=>!usedT.has(t)).slice(0,3).forEach(rt=>{usedT.add(rt);const tmpl=T[lang][Math.floor(Math.random()*T[lang].length)];const theme=info.themes[Math.floor(Math.random()*info.themes.length)];const sn=sectorNames[lang][info.sector]||info.sector;const filled=tmpl.replace(/{sector}/g,sn).replace(/{rt}/g,rt).replace(/{theme}/g,theme);const parts=filled.split(' â€” ');news.push({title:parts[0],content:parts[1]||parts[0],ticker:rt,source:['Reuters','Bloomberg','FT',"Barron's",'Seeking Alpha'][Math.floor(Math.random()*5)],date:genDate(Math.floor(Math.random()*72)+6),impact:Math.random()>.3?'positive':'neutral',tier:'related',tierLabel:lang==='ko'?`ğŸ”— ê´€ë ¨ Â· ${sn}`:`ğŸ”— Related Â· ${sn}`})})}});
  return news;
}

// === TIER 3+: ALL OTHER TIERS ===
function mkNews(T,lang,count,ticker,tier,tierLabel,sources,hRange){
  return pickRandom(T[lang],count).map((item,i)=>({title:item.t,content:item.c,ticker:typeof ticker==='function'?ticker(lang):ticker,source:sources[i%sources.length],date:genDate(Math.floor(Math.random()*((hRange||[2,96])[1]-(hRange||[2,96])[0]))+(hRange||[2,96])[0]),impact:item.i||'neutral',tier,tierLabel:typeof tierLabel==='function'?tierLabel(lang):tierLabel}));
}

function genMarket(l){return mkNews({ko:[{t:"S&P 500 ìµœê³ ì¹˜ í›„ ì¡°ì •",c:"ì°¨ìµ ì‹¤í˜„ ë§¤ë¬¼ì´ ë‚˜ì˜¤ê³  ìˆìŠµë‹ˆë‹¤."},{t:"ë‚˜ìŠ¤ë‹¥ 1% ìƒìŠ¹",c:"ê¸°ìˆ ì£¼ ê°•ì„¸ì— 1% ì˜¬ëìŠµë‹ˆë‹¤."},{t:"ë‹¤ìš° í˜¼ì¡°ì„¸",c:"ë°©ì–´ì£¼ ì¤‘ì‹¬ í˜¼ì¡°ì„¸ì…ë‹ˆë‹¤."},{t:"VIX 20 ëŒíŒŒ",c:"ì‹œì¥ ë¶ˆì•ˆê°ì´ ì»¤ì§€ê³  ìˆìŠµë‹ˆë‹¤."},{t:"ì¦ì‹œ ê´€ë§ì„¸",c:"ì§€í‘œ ë°œí‘œ ì•ë‘ê³  ê´€ë§ ì¤‘ì…ë‹ˆë‹¤."},{t:"ì—°ì°©ë¥™ ì „ë§ ìš°ì„¸",c:"íˆ¬ìì€í–‰ë“¤ì´ ì—°ì°©ë¥™ì— ë¬´ê²Œë¥¼ ë‘ê³  ìˆìŠµë‹ˆë‹¤."},{t:"ì˜µì…˜ ë§Œê¸° ë³€ë™ì„±",c:"ì˜µì…˜ ë§Œê¸°ë¥¼ ì•ë‘ê³  ë³€ë™ì„±ì´ ì»¤ì¡ŒìŠµë‹ˆë‹¤."},{t:"ì†Œë¹„ ì‹¬ë¦¬ í•˜ë½",c:"ì†Œë¹„ ì‹¬ë¦¬ê°€ 3ê°œì›” ì—°ì† í•˜ë½í–ˆìŠµë‹ˆë‹¤."}],en:[{t:"S&P Pulls Back After Record",c:"Profit-taking after record high."},{t:"Nasdaq Up 1%+",c:"Tech strength lifted Nasdaq."},{t:"Dow Mixed",c:"Rotation into defensives."},{t:"VIX Above 20",c:"Rising market anxiety."},{t:"Markets Await Data",c:"Cautious ahead of data."},{t:"Soft Landing Expected",c:"Banks betting on soft landing."},{t:"Options Expiry Vol",c:"Volatility on expiry."},{t:"Sentiment Down",c:"Consumer sentiment fell again."}]},l,8,x=>x==='ko'?'ì‹œì¥':'Market','market',x=>x==='ko'?'ğŸŒ ì‹œì¥':'ğŸŒ Market',['Bloomberg','FT','WSJ','Reuters','AP','CNBC','MarketWatch',"Barron's"])}

function genFed(l){return mkNews({ko:[{t:"ì—°ì¤€ ê¸ˆë¦¬ ì¸í•˜ ì„œë‘ë¥´ì§€ ì•Šê² ë‹¤",c:"íŒŒì›”ì´ ì¸í•˜ë¥¼ ì„œë‘ë¥´ì§€ ì•Šê² ë‹¤ê³  ë°í˜”ìŠµë‹ˆë‹¤."},{t:"10ë…„ë¬¼ 4.5% ëŒíŒŒ",c:"êµ­ì±„ ìˆ˜ìµë¥ ì´ 4.5%ë¥¼ ë„˜ì—ˆìŠµë‹ˆë‹¤."},{t:"ì—°ë‚´ ì¸í•˜ ê°€ëŠ¥ì„± ì‹œì‚¬",c:"ì—°ì¤€ ìœ„ì›ì´ ì—°ë‚´ ì¸í•˜ ê°€ëŠ¥ì„±ì„ ì–¸ê¸‰í–ˆìŠµë‹ˆë‹¤."},{t:"í˜ë“œì›Œì¹˜ 9ì›” ì¸í•˜ 60%",c:"9ì›” ì¸í•˜ í™•ë¥ ì´ 60%ë¥¼ ë„˜ì—ˆìŠµë‹ˆë‹¤."},{t:"CPI ë‘”í™” ì‹ í˜¸",c:"CPIê°€ ì˜ˆìƒì„ í•˜íšŒí–ˆìŠµë‹ˆë‹¤."},{t:"FOMC ì˜ê²¬ ë¶„ì—´",c:"íšŒì˜ë¡ì—ì„œ ì˜ê²¬ ì°¨ì´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"PPI ìƒìŠ¹",c:"PPIê°€ ì˜ˆìƒì„ ìƒíšŒí–ˆìŠµë‹ˆë‹¤."},{t:"ê³ ìš© ê²¬ê³ ",c:"ê³ ìš©ì´ ì˜ˆìƒì„ ìƒíšŒí–ˆìŠµë‹ˆë‹¤."}],en:[{t:"Fed: No Rush to Cut",c:"Powell reiterated patience."},{t:"10Y Breaks 4.5%",c:"Yield surged past 4.5%."},{t:"Fed Hints Cut This Year",c:"Governor suggested possible cut."},{t:"FedWatch: 60% Sept",c:"60%+ September cut probability."},{t:"CPI Cools",c:"CPI below expectations."},{t:"FOMC Divided",c:"Minutes show disagreement."},{t:"PPI Up",c:"PPI exceeded expectations."},{t:"Jobs Strong",c:"Payrolls beat estimates."}]},l,8,x=>x==='ko'?'ê¸ˆë¦¬':'Rates','fed',x=>x==='ko'?'ğŸ¦ ê¸ˆë¦¬Â·ì—°ì¤€':'ğŸ¦ Fed & Rates',['Bloomberg','Reuters','WSJ','CNBC','FT','AP','MarketWatch',"Barron's"])}

function genPolitics(l){return mkNews({ko:[{t:"ë°˜ë„ì²´ ë³´ì¡°ê¸ˆ 2ì°¨ ë°°ë¶„",c:"2ì°¨ ë³´ì¡°ê¸ˆ ê³„íšì´ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"ë¹…í…Œí¬ ê·œì œ ì‹¬ì˜",c:"ë…ì  ê·œì œ ì‹¬ì˜ì— ì°©ìˆ˜í–ˆìŠµë‹ˆë‹¤."},{t:"ëŒ€ì„  ê²½ì œê°€ í•µì‹¬",c:"ê²½ì œ ì •ì±…ì´ ìµœëŒ€ ê´€ì‹¬ì‚¬ì…ë‹ˆë‹¤."},{t:"íŠ¸ëŸ¼í”„ ê´€ì„¸ ê°•í™”",c:"ê´€ì„¸ ì¸ìƒì„ ì‹œì‚¬í–ˆìŠµë‹ˆë‹¤."},{t:"SEC ì•”í˜¸í™”í ê·œì œ",c:"ìƒˆ ê·œì œê°€ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"AI ê·œì œ í–‰ì •ëª…ë ¹",c:"AI ì•ˆì „ì„± ëª…ë ¹ì´ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"ì…§ë‹¤ìš´ ìš°ë ¤",c:"ì…§ë‹¤ìš´ ê°€ëŠ¥ì„±ì´ ë¶€ê° ì¤‘ì…ë‹ˆë‹¤."},{t:"ë°©ì‚° ì˜ˆì‚° ìµœëŒ€",c:"ìµœëŒ€ ë°©ì‚° ì˜ˆì‚°ì´ ì¶”ì§„ ì¤‘ì…ë‹ˆë‹¤."},{t:"FTC M&A ê°•í™”",c:"M&A ì‹¬ì‚¬ê°€ ê°•í™”ë©ë‹ˆë‹¤."},{t:"EV ë³´ì¡°ê¸ˆ ê°•í™”",c:"EV ì„¸ê¸ˆ ê³µì œ ìš”ê±´ì´ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤."}],en:[{t:"CHIPS 2nd Round",c:"Second subsidy round announced."},{t:"Big Tech Regulation",c:"Antitrust hearings started."},{t:"Economy Top Issue",c:"Economy is top voter concern."},{t:"Trump Tariff Signal",c:"Higher tariffs signaled."},{t:"SEC Crypto Rules",c:"New crypto framework."},{t:"AI Regulation Order",c:"AI safety order issued."},{t:"Shutdown Fears",c:"Budget talks stalled."},{t:"Record Defense Budget",c:"Largest defense budget pushed."},{t:"FTC M&A Rules",c:"Stricter merger review."},{t:"EV Credit Tightened",c:"Stricter EV eligibility."}]},l,10,x=>x==='ko'?'ì •ì¹˜':'Politics','politics',x=>x==='ko'?'ğŸ›ï¸ ì •ì¹˜':'ğŸ›ï¸ Politics',['Politico','AP','Reuters','WSJ','WashPost','CNN','Bloomberg','Hill','NYT','NPR'])}

function genUSChina(l){return mkNews({ko:[{t:"AI ì¹© ê·œì œ ê°•í™”",c:"ì¤‘êµ­ ëŒ€ìƒ AI ì¹© ê·œì œê°€ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"í¬í† ë¥˜ ìˆ˜ì¶œ ì œí•œ",c:"í¬í† ë¥˜ ìˆ˜ì¶œ ì œí•œì´ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"ë”¥ì‹œí¬ AI ìš°ìœ„ ìœ„í˜‘",c:"ì €ë¹„ìš© ê³ ì„±ëŠ¥ AI ëª¨ë¸ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"í™”ì›¨ì´ ìì²´ ì¹© ì„œë²„",c:"ìì²´ ì¹© AI ì„œë²„ê°€ ì¶œì‹œë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"ê³µê¸‰ë§ ì¬í¸ ê°€ì†",c:"ê³µê¸‰ë§ ì¬í¸ì´ ê°€ì†í™” ì¤‘ì…ë‹ˆë‹¤."},{t:"ì¤‘êµ­ EV ìœ ëŸ½ í™•ëŒ€",c:"BYDê°€ ìœ ëŸ½ ì‹œì¥ì„ í™•ëŒ€í•˜ê³  ìˆìŠµë‹ˆë‹¤."},{t:"ë°”ì´ì˜¤ íˆ¬ì ì œí•œ",c:"ë°”ì´ì˜¤í…Œí¬ íˆ¬ì ì œí•œ ê²€í†  ì¤‘ì…ë‹ˆë‹¤."},{t:"ëŒ€ë§Œ í•´í˜‘ ê¸´ì¥",c:"ë°˜ë„ì²´ ë¦¬ìŠ¤í¬ê°€ ë¶€ê° ì¤‘ì…ë‹ˆë‹¤."},{t:"ì¤‘êµ­ ê²½ì œ ë‘”í™”",c:"ì„±ì¥ë¥  í•˜ë½ ìš°ë ¤ê°€ ì»¤ì§€ê³  ìˆìŠµë‹ˆë‹¤."},{t:"ì–‘ìì»´í“¨í„° ê²½ìŸ",c:"ì–‘ì ë¶„ì•¼ë¡œ ê²½ìŸì´ í™•ì‚° ì¤‘ì…ë‹ˆë‹¤."}],en:[{t:"AI Chip Controls Tightened",c:"Further restrictions to China."},{t:"Rare Earth Limits",c:"Export restrictions announced."},{t:"DeepSeek AI Threat",c:"High-performance model unveiled."},{t:"Huawei Own-Chip Server",c:"Self-developed chip servers launched."},{t:"Supply Chain Shift",c:"Restructuring accelerating."},{t:"Chinese EVs in Europe",c:"BYD gaining market share."},{t:"Biotech Limits Reviewed",c:"Investment restrictions under review."},{t:"Taiwan Tensions",c:"Chip supply risks highlighted."},{t:"China Slowdown",c:"Growth below expectations."},{t:"Quantum Race",c:"Rivalry enters quantum computing."}]},l,10,x=>x==='ko'?'ë¯¸ì¤‘':'US-China','uschina',x=>x==='ko'?'ğŸ‡ºğŸ‡¸ğŸ‡¨ğŸ‡³ ë¯¸ì¤‘':'ğŸ‡ºğŸ‡¸ğŸ‡¨ğŸ‡³ US-China',['Reuters','Bloomberg','SCMP','Nikkei','WSJ','FT','AP','CNN','Diplomat','Politico'])}

function genGeo(l){return mkNews({ko:[{t:"ì¤‘ë™ ìœ ê°€ ê¸‰ë“±",c:"ì§€ì •í•™ì  ê¸´ì¥ìœ¼ë¡œ ìœ ê°€ê°€ ì˜¬ëìŠµë‹ˆë‹¤."},{t:"ìš°í¬ë¼ì´ë‚˜ ì—ë„ˆì§€ ìœ„ê¸°",c:"ì—ë„ˆì§€ ì•ˆë³´ ìš°ë ¤ê°€ ì»¤ì§€ê³  ìˆìŠµë‹ˆë‹¤."},{t:"NATO ë°©ìœ„ë¹„ ì¦ì•¡",c:"ë°©ìœ„ë¹„ 3%ê¹Œì§€ ì¦ì•¡ í•©ì˜í–ˆìŠµë‹ˆë‹¤."},{t:"ì—”í™” ì•½ì„¸ ì§€ì†",c:"í™˜ìœ¨ ì „ìŸ ìš°ë ¤ê°€ ë‚˜ì˜µë‹ˆë‹¤."},{t:"ì¸ë„ ì œì¡° í—ˆë¸Œ",c:"ì¸ë„ê°€ ì œì¡°ì—… í—ˆë¸Œë¡œ ë¶€ìƒ ì¤‘ì…ë‹ˆë‹¤."},{t:"ì‹ëŸ‰ ê°€ê²© ìƒìŠ¹",c:"ì‹ëŸ‰ ê°€ê²©ì´ ì˜¤ë¥´ê³  ìˆìŠµë‹ˆë‹¤."},{t:"OPEC+ ê°ì‚° ì—°ì¥",c:"ê°ì‚°ì´ ì—°ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."},{t:"í™í•´ í•´ìš´ë¹„ ê¸‰ë“±",c:"í•´ìš´ ë¹„ìš©ì´ ê¸‰ë“± ì¤‘ì…ë‹ˆë‹¤."}],en:[{t:"Middle East Oil Surge",c:"Tensions driving oil higher."},{t:"Ukraine Energy Crisis",c:"Energy concerns reviving."},{t:"NATO Defense Boost",c:"3% GDP defense agreed."},{t:"Yen Weakness",c:"Currency war fears."},{t:"India Manufacturing",c:"India as new hub."},{t:"Food Prices Up",c:"Climate driving prices."},{t:"OPEC+ Cuts Extended",c:"Production cuts extended."},{t:"Red Sea Shipping Spike",c:"Shipping costs surging."}]},l,8,x=>x==='ko'?'ì§€ì •í•™':'Geopolitics','geopolitics',x=>x==='ko'?'ğŸŒ ì§€ì •í•™':'ğŸŒ Geopolitics',['Reuters','Bloomberg','BBC','Al Jazeera','FT','AP','DW','Nikkei'])}

function genCrypto(l){return mkNews({ko:[{t:"ë¹„íŠ¸ì½”ì¸ 10ë§Œë¶ˆ í›„ ì¡°ì •",c:"ì°¨ìµ ì‹¤í˜„ ì¡°ì • ì¤‘ì…ë‹ˆë‹¤.",i:'neutral'},{t:"ì´ë”ë¦¬ì›€ ETF ê¸°ëŒ€",c:"ETF ê¸°ëŒ€ì— ìƒìŠ¹ ì¤‘ì…ë‹ˆë‹¤.",i:'positive'},{t:"ìŠ¤í…Œì´ë¸”ì½”ì¸ ë²•ì•ˆ ì„ë°•",c:"ê·œì œ ë²•ì•ˆì´ í†µê³¼ë¥¼ ì•ë‘ê³  ìˆìŠµë‹ˆë‹¤."},{t:"ì±„êµ´ ìˆ˜ìµì„± ë¶„í™”",c:"ë°˜ê°ê¸° í›„ ìˆ˜ìµì„±ì´ ê°ˆë¦¬ê³  ìˆìŠµë‹ˆë‹¤."},{t:"ê¸°ê´€ ì•”í˜¸í™”í í™•ëŒ€",c:"ê¸°ê´€ë“¤ì´ ë¹„ì¤‘ì„ ëŠ˜ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.",i:'positive'},{t:"DeFi TVL ìµœê³ ",c:"DeFi TVLì´ ìµœê³ ì¹˜ì…ë‹ˆë‹¤.",i:'positive'}],en:[{t:"BTC Corrects After $100K",c:"Profit-taking pullback.",i:'neutral'},{t:"ETH ETF Hopes",c:"ETF expectations rising.",i:'positive'},{t:"Stablecoin Bill Near",c:"Regulation approaching vote."},{t:"Mining Diverges",c:"Post-halving profitability varies."},{t:"Institutions Boost Crypto",c:"Increasing allocations.",i:'positive'},{t:"DeFi TVL Record",c:"All-time high TVL.",i:'positive'}]},l,6,x=>x==='ko'?'ì•”í˜¸í™”í':'Crypto','crypto',x=>x==='ko'?'â‚¿ ì•”í˜¸í™”í':'â‚¿ Crypto',['CoinDesk','The Block','Decrypt','Bloomberg','CoinTelegraph','Messari'])}

function genTech(l){return mkNews({ko:[{t:"GPT-5 ê³µê°œ ì„ë°•",c:"ì˜¤í”ˆAIê°€ GPT-5ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.",i:'positive'},{t:"AI íˆ¬ì 2000ì–µë¶ˆ",c:"ê¸€ë¡œë²Œ AI íˆ¬ìê°€ ê¸‰ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤.",i:'positive'},{t:"ë¹„ì „ í”„ë¡œ 2ì„¸ëŒ€",c:"ì• í”Œì´ 2ì„¸ëŒ€ë¥¼ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.",i:'positive'},{t:"ììœ¨ì£¼í–‰ ë ˆë²¨4",c:"ë ˆë²¨4 ìƒìš©í™”ê°€ ê·¼ì ‘í–ˆìŠµë‹ˆë‹¤.",i:'positive'},{t:"ì–‘ìì»´í“¨í„° ì‹¤ìš©í™”",c:"ì‹¤ìš©ì  ì‚¬ë¡€ê°€ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤.",i:'positive'},{t:"AI ì—ì´ì „íŠ¸ ì‹œëŒ€",c:"ì—…ë¬´ ìë™í™”ê°€ í˜ëª… ì¤‘ì…ë‹ˆë‹¤.",i:'positive'},{t:"ë°ì´í„°ì„¼í„° ì „ë ¥ ë¬¸ì œ",c:"ì „ë ¥ ë¶€ì¡±ì´ ëŒ€ë‘ ì¤‘ì…ë‹ˆë‹¤."},{t:"íœ´ë¨¸ë…¸ì´ë“œ ë¡œë´‡",c:"ë¡œë´‡ ê¸°ì—…ë“¤ì´ ì„±ì¥ ì¤‘ì…ë‹ˆë‹¤.",i:'positive'}],en:[{t:"GPT-5 Imminent",c:"OpenAI preparing launch.",i:'positive'},{t:"AI Investment $200B+",c:"Global AI spending surging.",i:'positive'},{t:"Vision Pro 2",c:"Apple developing next-gen.",i:'positive'},{t:"Level 4 Driving Near",c:"Approaching commercialization.",i:'positive'},{t:"Quantum Practical",c:"Practical applications shown.",i:'positive'},{t:"AI Agent Era",c:"Transforming workflows.",i:'positive'},{t:"Data Center Power",c:"Power becoming constraint."},{t:"Humanoid Robots",c:"Companies growing fast.",i:'positive'}]},l,8,x=>x==='ko'?'í…Œí¬':'Tech','techtrends',x=>x==='ko'?'ğŸš€ í…Œí¬':'ğŸš€ Tech Trends',['TechCrunch','Verge','Wired','Ars','MIT Review','Bloomberg','Reuters','CNBC'])}

function genCommodities(l){return mkNews({ko:[{t:"ê¸ˆ ì‚¬ìƒ ìµœê³  ê·¼ì ‘",c:"ê¸ˆ ê°€ê²©ì´ ì˜¤ë¥´ê³  ìˆìŠµë‹ˆë‹¤."},{t:"ìœ ê°€ 85ë‹¬ëŸ¬",c:"ì¤‘ë™ ê¸´ì¥ìœ¼ë¡œ ìœ ê°€ê°€ ì˜¬ëìŠµë‹ˆë‹¤."},{t:"êµ¬ë¦¬ ê¸‰ë“± AI ìˆ˜ìš”",c:"ë°ì´í„°ì„¼í„° êµ¬ë¦¬ ìˆ˜ìš”ê°€ ê¸‰ì¦ ì¤‘ì…ë‹ˆë‹¤."},{t:"ë¦¬íŠ¬ ë°˜ë“±",c:"EV ìˆ˜ìš” íšŒë³µ ê¸°ëŒ€ì…ë‹ˆë‹¤."},{t:"ì²œì—°ê°€ìŠ¤ ìƒìŠ¹",c:"ê²¨ìš¸ ìˆ˜ìš”ë¡œ ê°€ê²©ì´ ì˜¬ëìŠµë‹ˆë‹¤."},{t:"ì€ ë™ë°˜ ìƒìŠ¹",c:"ê¸ˆê³¼ í•¨ê»˜ ì€ë„ ì˜¤ë¥´ê³  ìˆìŠµë‹ˆë‹¤."}],en:[{t:"Gold Nears Record",c:"Uncertainty driving gold."},{t:"Oil at $85",c:"Middle East tensions."},{t:"Copper on AI Demand",c:"Data center demand."},{t:"Lithium Rebounds",c:"EV demand recovery."},{t:"Natural Gas Up",c:"Winter demand outlook."},{t:"Silver Rallies",c:"Rising with gold."}]},l,6,x=>x==='ko'?'ì›ìì¬':'Commodities','commodities',x=>x==='ko'?'â›ï¸ ì›ìì¬':'â›ï¸ Commodities',['Bloomberg','Reuters','Kitco','OilPrice','Mining.com','S&P Global'])}

function genEarnings(l){return mkNews({ko:[{t:"S&P 75% ì˜ˆìƒ ìƒíšŒ",c:"ê¸°ì—… 75%ê°€ ì˜ˆìƒì„ ë„˜ì—ˆìŠµë‹ˆë‹¤.",i:'positive'},{t:"ë¹…í…Œí¬ ì‹¤ì  ì£¼ê°„",c:"ë¹…í…Œí¬ ì‹¤ì ì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤."},{t:"ì€í–‰ ì‹¤ì  í˜¸ì¡°",c:"ì€í–‰ë“¤ì´ ê¸ˆë¦¬ ìˆ˜í˜œë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.",i:'positive'},{t:"ì†Œë¹„ì¬ ë‘”í™”",c:"ì†Œë¹„ì¬ ì‹¤ì ì´ ë¶€ì§„í•©ë‹ˆë‹¤.",i:'negative'},{t:"AI ê¸°ì—… ê°€ì´ë˜ìŠ¤ ìƒí–¥",c:"AI ê¸°ì—…ë“¤ì´ ê°€ì´ë˜ìŠ¤ë¥¼ ì˜¬ë ¸ìŠµë‹ˆë‹¤.",i:'positive'},{t:"í—¬ìŠ¤ì¼€ì–´ ì•ˆì •",c:"í—¬ìŠ¤ì¼€ì–´ê°€ ë°©ì–´ì£¼ ì—­í•  ì¤‘ì…ë‹ˆë‹¤."}],en:[{t:"75% S&P Beat",c:"Three-quarters beat estimates.",i:'positive'},{t:"Big Tech Week",c:"Major earnings expected."},{t:"Banks Strong",c:"Rate benefits confirmed.",i:'positive'},{t:"Consumer Slow",c:"Spending concerns rising.",i:'negative'},{t:"AI Guidance Up",c:"AI companies raising outlook.",i:'positive'},{t:"Healthcare Steady",c:"Defensive earnings stable."}]},l,6,x=>x==='ko'?'ì‹¤ì ':'Earnings','earnings',x=>x==='ko'?'ğŸ“Š ì‹¤ì ':'ğŸ“Š Earnings',['Bloomberg','Reuters','CNBC','MarketWatch',"Barron's",'Seeking Alpha'])}

function genTrending(tickers,l){
  const T={ko:[{ticker:'PLTR',t:"PLTR ì •ë¶€ ê³„ì•½ ê¸‰ì¦",c:"ì •ë¶€ ê³„ì•½ì„ ìˆ˜ì£¼í–ˆìŠµë‹ˆë‹¤.",i:'positive'},{ticker:'COIN',t:"COIN ë¹„íŠ¸ì½”ì¸ ë™ë°˜ ê¸‰ë“±",c:"ì•”í˜¸í™”í ê°•ì„¸ì— ê¸‰ë“±í–ˆìŠµë‹ˆë‹¤.",i:'positive'},{ticker:'SMCI',t:"SMCI AI ì„œë²„ ê¸‰ë“±",c:"AI ì„œë²„ ìˆ˜ìš”ë¡œ ê¸‰ë“±í–ˆìŠµë‹ˆë‹¤.",i:'positive'},{ticker:'SOFI',t:"SOFI ì„±ì¥ ê°€ì†",c:"ì‚¬ì—… ë‹¤ê°í™”ë¡œ ì„±ì¥ ì¤‘ì…ë‹ˆë‹¤.",i:'positive'},{ticker:'ARM',t:"ARM AI ì¹© ìˆ˜í˜œ",c:"AI ì¹© ìˆ˜ìš” ìˆ˜í˜œë¥¼ ë°›ê³  ìˆìŠµë‹ˆë‹¤.",i:'positive'},{ticker:'CRWD',t:"CRWD ì‚¬ì´ë²„ë³´ì•ˆ ê¸‰ì¦",c:"ë³´ì•ˆ íˆ¬ì í™•ëŒ€ë¡œ ì„±ì¥ ì¤‘ì…ë‹ˆë‹¤.",i:'positive'},{ticker:'SNOW',t:"SNOW í´ë¼ìš°ë“œ í™•ëŒ€",c:"í´ë¼ìš°ë“œ ì…ì§€ë¥¼ ê°•í™” ì¤‘ì…ë‹ˆë‹¤.",i:'positive'},{ticker:'UBER',t:"UBER ììœ¨ì£¼í–‰ íŒŒíŠ¸ë„ˆì‹­",c:"ììœ¨ì£¼í–‰ íŒŒíŠ¸ë„ˆì‹­ì„ ì²´ê²°í–ˆìŠµë‹ˆë‹¤.",i:'positive'},{ticker:'AI',t:"C3.ai AI ìˆ˜ìš” ê¸‰ë“±",c:"ê¸°ì—…ìš© AI ìˆ˜ìš”ê°€ ê¸‰ì¦í–ˆìŠµë‹ˆë‹¤.",i:'positive'},{ticker:'MARA',t:"MARA ì±„êµ´ íš¨ìœ¨ ê°œì„ ",c:"ì±„êµ´ íš¨ìœ¨ì„ í¬ê²Œ ê°œì„ í–ˆìŠµë‹ˆë‹¤.",i:'positive'}],en:[{ticker:'PLTR',t:"PLTR Gov Contract Surge",c:"Major contract win.",i:'positive'},{ticker:'COIN',t:"COIN Rallies with BTC",c:"Crypto rally lifts stock.",i:'positive'},{ticker:'SMCI',t:"SMCI AI Server Jump",c:"AI demand surge.",i:'positive'},{ticker:'SOFI',t:"SOFI Growth Accelerates",c:"Banking license driving growth.",i:'positive'},{ticker:'ARM',t:"ARM AI Chip Benefit",c:"Royalty boost from AI.",i:'positive'},{ticker:'CRWD',t:"CRWD Cybersecurity Boom",c:"Security spending surge.",i:'positive'},{ticker:'SNOW',t:"SNOW Cloud Expansion",c:"Platform growth continues.",i:'positive'},{ticker:'UBER',t:"UBER Autonomous Deal",c:"Self-driving partnership.",i:'positive'},{ticker:'AI',t:"C3.ai Enterprise Demand",c:"AI solution demand booming.",i:'positive'},{ticker:'MARA',t:"MARA Mining Gains",c:"Efficiency improvements.",i:'positive'}]};
  return pickRandom(T[l].filter(x=>!tickers.includes(x.ticker)),8).map((item,i)=>({title:item.t,content:item.c,ticker:item.ticker,source:['Reddit','WSB','Seeking Alpha','Benzinga','TipRanks','Motley Fool','Stocktwits','Finviz'][i%8],date:genDate(Math.floor(Math.random()*48)+2),impact:item.i,tier:'trending',tierLabel:l==='ko'?'ğŸ”¥ íŠ¸ë Œë”©':'ğŸ”¥ Trending'}));
}

// SPA fallback
app.get('*',(req,res)=>res.sendFile(path.join(__dirname,'public','index.html')));
app.listen(PORT,()=>console.log(`âœ… Stock News running on port ${PORT}`));
